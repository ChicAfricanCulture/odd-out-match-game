<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>African Foodways: Odd One Out</title>

  <style>
    :root{
      --bg1:#1a2a3a; --bg2:#0d1b2a;
      --accent:#f9a826; --muted:#b8c7d6; --text:#e0e0e0;
      --panel: rgba(26,42,58,0.86);
      --tileBorder:#c49a6c;
    }
    *{ box-sizing:border-box; }
    body{
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .container{ width:100%; max-width: 960px; text-align:center; }

    h1{ color: var(--accent); font-size: 2rem; margin: 10px 0 6px; }
    .subtitle{ color: var(--muted); margin: 0 0 10px; }

    .instructions{
      max-width: 720px;
      margin: 0 auto 14px;
      background: rgba(249,168,38,0.14);
      border: 1px solid rgba(249,168,38,0.45);
      border-radius: 12px;
      padding: 12px 14px;
      text-align:left;
      line-height: 1.35;
    }
    .instructions strong{ color: var(--accent); }
    .instructions .small{ color: var(--muted); font-size: 0.95rem; margin-top: 6px; }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin: 10px 0 12px;
    }
    .stats{
      display:flex; gap:16px; justify-content:center; flex-wrap:wrap;
      color: var(--accent); font-size: 1.05rem;
    }
    .controls{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }

    button{
      background: linear-gradient(135deg, var(--accent), #e8951e);
      color:#1a2a3a;
      border:none;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 800;
      cursor:pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
    }
    button:hover{ transform: translateY(-2px); box-shadow: 0 4px 12px rgba(249,168,38,0.40); }
    button:disabled{ opacity:0.55; cursor:not-allowed; }

    .timer-wrap{
      max-width: 520px;
      margin: 0 auto 14px;
      background: var(--panel);
      border-radius: 12px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.10);
      text-align:left;
    }
    .timer-label{
      display:flex;
      justify-content:space-between;
      align-items:center;
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 10px;
    }
    .bar{
      width:100%;
      height:12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:100%;
      background: linear-gradient(135deg, var(--accent), #e8951e);
      transform-origin:left center;
      transform: scaleX(1);
    }

    .game-board{
      display:grid;
      grid-template-columns: repeat(2, minmax(140px, 1fr));
      gap: 14px;
      max-width: 520px;
      margin: 0 auto 16px;
    }
    .tile{
      aspect-ratio: 1 / 1;
      background: #ffffff;
      border: 3px solid var(--tileBorder);
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.45);
      overflow:hidden;
      outline:none;
      position: relative;
    }
    .tile:hover{ transform: scale(1.02); }
    .tile:focus-visible{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(249,168,38,0.35), 0 5px 15px rgba(0,0,0,0.45);
    }
    .tile img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
      pointer-events:none;
    }

    .tile.selected{
      border-color: var(--accent);
      box-shadow: 0 0 18px rgba(249,168,38,0.70), 0 5px 15px rgba(0,0,0,0.45);
    }
    .tile.wrong{ animation: shake 0.45s; border-color:#ff4444; }
    .tile.correct-reveal{
      border-color:#7CFF7C;
      box-shadow: 0 0 16px rgba(124,255,124,0.55), 0 5px 15px rgba(0,0,0,0.45);
    }
    @keyframes shake {
      0%,100%{ transform: translateX(0); }
      25%{ transform: translateX(-5px); }
      75%{ transform: translateX(5px); }
    }

    .feedback{
      min-height: 90px;
      padding: 16px;
      background: var(--panel);
      border-radius: 12px;
      margin: 0 auto 12px;
      max-width: 720px;
      text-align:left;
      line-height: 1.45;
      font-size: 1.02rem;
    }

    .loading{
      color: var(--muted);
      font-size: 0.95rem;
      margin: 6px 0 0;
      text-align:center;
    }

    @media (max-width: 520px){
      .game-board{ grid-template-columns: repeat(2, minmax(120px, 1fr)); }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>African Foodways: Odd One Out</h1>
    <p class="subtitle">Look closely. One image doesnâ€™t belong.</p>

    <div class="instructions" role="note" aria-label="How to play">
      <strong>How to play:</strong> You have <strong>10 seconds</strong>. Click the image that does <strong>not</strong> belong.
      <div class="small">Tip: compare texture, base ingredients, and how the dish is served.</div>
    </div>

    <div class="top-row">
      <div class="stats" aria-label="Game statistics">
        <div>Round: <span id="round">1</span>/<span id="total-rounds">0</span></div>
        <div>Score: <span id="score">0</span></div>
      </div>

      <div class="controls">
        <button id="tick-btn" aria-pressed="false">ðŸ”‡ Tick: Off</button>
        <button id="restart-btn">ðŸ†• Restart</button>
      </div>
    </div>

    <div class="timer-wrap" aria-label="Round timer">
      <div class="timer-label">
        <span>Time left</span>
        <span><span id="time-left">10</span>s</span>
      </div>
      <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="10" aria-valuenow="10">
        <div id="bar-fill"></div>
      </div>
      <div class="loading" id="loading"></div>
    </div>

    <div class="game-board" id="board" aria-label="Odd one out board"></div>

    <div class="feedback" id="feedback" aria-live="polite">
      Images are loadingâ€¦
    </div>

    <button id="next-btn" style="display:none;">Next Round</button>
  </div>

  <script>
    // ==================== CONFIG ====================
    const CHOICE_SECONDS = 10;

  // ==================== ROUNDS ====================
const rounds = [
  {
    name: "Fufu Variations",
    odd: 3,
    images: ["fufu1.jpg", "fufu2.jpg", "fufu3.jpg", "mashed-potato.jpg"],
    explain: "Mashed potatoes are the odd one out. Fufu is pounded cassava/yam/plantain and eaten with soup; mashed potatoes are whipped and typically eaten with a fork."
  },
  {
    name: "Banana vs. Plantain",
    odd: 3,
    images: [
      "r02_banana_1.jpg",
      "r02_banana_2.jpg",
      "r02_banana_3.jpg",
      "r02_plantain_odd.jpg"
    ],
    explain: "Plantains are starchier and usually cooked; bananas are sweeter and often eaten raw."
  },
  {
    name: "Jollof Rice vs. Fried Rice",
    odd: 3,
    images: [
      "r03_Jollof_1.jpg",
      "r03_Jollof_2.jpg",
      "r03_Jollof_3.jpg",
      "r03_Fried_odd.jpg"
    ],
    explain: "Jollof rice is cooked in a tomato-pepper base, giving it a uniform red-orange color and integrated flavor. Fried rice is stir-fried with visible separate grains, vegetables, and often egg."
  },
  {
    name: "Yam vs. Sweet Potato",
    odd: 3,
    images: [
      "r04_Yam_1.jpg",
      "r04_Yam_2.jpg",
      "r04_Yam_3.jpg",
      "r04_sweet_potato_odd.jpg"
    ],
    explain: "True yams are starchier with rough brown skin and pale flesh. Sweet potatoes are sweeter, often orange inside, and softer when cooked."
  },
  {
    name: "Ugali vs. Grits",
    odd: 3,
    images: [
      "r05_ugali_1.jpg",
      "r05_ugali_2.jpg",
      "r05_ugali_3.jpg",
      "r05_grits_odd.jpg"
    ],
    explain: "Ugali is firm, molded maize porridge meant to be shaped and dipped. Grits are softer, spoonable, and often served creamy."
  },  {
    name: "Agege Bread vs White Bread",
    odd: 3,
    images: [
      "r06_agege_1.jpg",
      "r06_agege_2.jpg",
      "r06_agege_3.jpg",
      "r06_white_bread_odd.jpg"
    ],
    explain: "Agege bread is soft, stretchy, and slightly sweet with a distinct yellow hue. Standard white sandwich bread is lighter, drier, and evenly sliced."
  },
  {
    name: "Kisra vs Tortilla",
    odd: 3,
    images: [
      "r07_kisra_1.jpg",
      "r07_kisra_2.jpg",
      "r07_kisra_3.jpg",
      "r07_tortilla_odd.jpg"
    ],
    explain: "Kisra is a thin fermented sorghum flatbread with a porous texture. Tortillas are typically wheat or corn-based and not fermented in the same way."
  },
  {
    name: "Banku vs Couscous",
    odd: 3,
    images: [
      "r08_banku_1.jpg",
      "r08_banku_2.jpg",
      "r08_banku_3.jpg",
      "r08_couscous_odd.jpg"
    ],
    explain: "Banku is a fermented corn and cassava dough formed into smooth balls. Couscous consists of tiny steamed semolina grains."
  },
  {
    name: "Kenkey vs Tamales",
    odd: 3,
    images: [
      "r09_kenkey_1.jpg",
      "r09_kenkey_2.jpg",
      "r09_kenkey_3.jpg",
      "r09_tamale_odd.jpg"
    ],
    explain: "Kenkey is fermented maize dough wrapped in husks and boiled. Tamales are masa-based, often filled, and steamed in husks."
  },
  {
    name: "Lablab vs Lima Beans",
    odd: 3,
    images: [
      "r10_lablab_1.jpg",
      "r10_lablab_2.jpg",
      "r10_lablab_3.jpg",
      "r10_lima_bean_odd.jpg"
    ],
    explain: "Lablab beans (hyacinth beans) are typically smaller and darker with varied shapes. Lima beans are flatter, lighter in color, and more uniform."
  },
  {
    name: "Bambara Groundnut vs Peanut",
    odd: 3,
    images: [
      "r11_bambara_1.jpg",
      "r11_bambara_2.jpg",
      "r11_bambara_3.jpg",
      "r11_peanut_odd.jpg"
    ],
    explain: "Bambara groundnuts grow underground like peanuts but are rounder and thicker. Peanuts are elongated and typically found in two-lobed shells."
  },
 {
  name: "Cowpea Varieties (Dried)",
  images: [
    "dried_blackeye.jpg",
    "dried_pinkeye.jpg",
    "dried_cream.jpg",
    "dried_crowder.jpg"
  ],
  oddOneLabel: "dried_crowder.jpg",
  explain: "Crowder cowpeas are the odd one out â€” they grow so tightly packed in the pod that the seeds become squared-off or blocky. Blackeye, pinkeye and cream types remain more rounded or kidney-shaped even when dry."
}
];
    // ==================== STATE ====================
    let currentRound = 0;
    let score = 0;
    let solved = false;

    let timerId = null;
    let timeLeft = CHOICE_SECONDS;

    // Tick sound (optional)
    let tickOn = false;
    let audioCtx = null;

    // ==================== DOM ====================
    const boardEl = document.getElementById('board');
    const feedbackEl = document.getElementById('feedback');
    const nextBtn = document.getElementById('next-btn');
    const restartBtn = document.getElementById('restart-btn');
    const tickBtn = document.getElementById('tick-btn');

    const roundEl = document.getElementById('round');
    const totalRoundsEl = document.getElementById('total-rounds');
    const scoreEl = document.getElementById('score');

    const timeLeftEl = document.getElementById('time-left');
    const barFill = document.getElementById('bar-fill');
    const progressBar = document.querySelector('.bar');
    const loadingEl = document.getElementById('loading');

    totalRoundsEl.textContent = String(rounds.length);

    function setFeedback(html){ feedbackEl.innerHTML = html; }

    // ==================== ASSETS ====================
    function imgUrl(fileName){
      return new URL(`images/${fileName}`, document.baseURI).href;
    }

    function makeMissingSvg(text){
      const safe = String(text).replace(/[<>&"]/g, '');
      const svg =
        `<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400">
          <rect width="100%" height="100%" fill="#f9a826"/>
          <text x="50%" y="45%" text-anchor="middle" font-size="26" font-family="Arial" fill="#1a2a3a">Missing file</text>
          <text x="50%" y="62%" text-anchor="middle" font-size="16" font-family="Arial" fill="#1a2a3a">${safe}</text>
        </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // ==================== AUDIO ====================
    function ensureAudio(){
      if(!tickOn) return null;
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if(!Ctx) return null;
      if(!audioCtx) audioCtx = new Ctx();
      if(audioCtx.state === 'suspended'){
        audioCtx.resume().catch(()=>{});
      }
      return audioCtx;
    }

    function playTick(){
      const ctx = ensureAudio();
      if(!ctx) return;

      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = 850;

      const now = ctx.currentTime;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.linearRampToValueAtTime(0.04, now + 0.005);
      g.gain.linearRampToValueAtTime(0.0001, now + 0.05);

      o.connect(g);
      g.connect(ctx.destination);
      o.start(now);
      o.stop(now + 0.06);
    }

    function updateTickButton(){
      tickBtn.setAttribute('aria-pressed', String(tickOn));
      tickBtn.textContent = tickOn ? 'ðŸ”Š Tick: On' : 'ðŸ”‡ Tick: Off';
    }

    tickBtn.addEventListener('click', () => {
      tickOn = !tickOn;
      updateTickButton();
      if(tickOn){
        ensureAudio();
        playTick();
      }
    });

    // ==================== TIMER ====================
    function stopTimer(){
      if(timerId) clearInterval(timerId);
      timerId = null;
    }

    function updateTimerUI(){
      timeLeftEl.textContent = String(timeLeft);
      const ratio = Math.max(0, Math.min(1, timeLeft / CHOICE_SECONDS));
      barFill.style.transform = `scaleX(${ratio})`;
      progressBar.setAttribute('aria-valuenow', String(timeLeft));
    }

    function startTimer(){
      stopTimer();
      timeLeft = CHOICE_SECONDS;
      updateTimerUI();

      timerId = setInterval(() => {
        if(solved){ stopTimer(); return; }
        timeLeft -= 1;
        if(tickOn) playTick();
        updateTimerUI();

        if(timeLeft <= 0){
          stopTimer();
          onTimeUp();
        }
      }, 1000);
    }

    function onTimeUp(){
      const round = rounds[currentRound];
      highlightCorrect(round.odd);
      solved = true;
      setFeedback(`<strong>Timeâ€™s up!</strong> The odd one out was highlighted.<br/>${round.explain}`);
      nextBtn.style.display = 'inline';
    }
// Shuffle the images order randomly
const shuffledIndices = [0,1,2,3].sort(() => Math.random() - 0.5);
let correctDisplayIndex = -1;

// Then in your tile-creation loop, change to:
for (let pos = 0; pos < 4; pos++) {
  const originalIdx = shuffledIndices[pos];
  const fileName = round.images[originalIdx];

  // ... create tile and img as before ...
  img.src = imgUrl(fileName);

  if (originalIdx === round.odd) {
    correctDisplayIndex = pos;
  }
}

// Store for checking / highlighting
round._currentCorrectPos = correctDisplayIndex;  // temp per play
    // ==================== ROUND ====================
    function clearSelections(){
      boardEl.querySelectorAll('.tile').forEach(t => t.classList.remove('selected','wrong'));
    }

    function highlightCorrect(correctIdx){
      const tile = boardEl.querySelector(`.tile[data-index="${correctIdx}"]`);
      if(tile) tile.classList.add('correct-reveal');
    }

    function markSelection(tileEl, correct){
      clearSelections();
      tileEl.classList.add('selected');
      if(!correct){
        tileEl.classList.add('wrong');
        setTimeout(() => tileEl.classList.remove('wrong'), 450);
      }
    }

    function preloadRoundImages(round){
      const urls = round.images.map(fn => imgUrl(fn));
      return Promise.all(urls.map(url => new Promise(resolve => {
        const i = new Image();
        i.onload = () => resolve({ url, ok: true });
        i.onerror = () => resolve({ url, ok: false });
        i.src = url;
      })));
    }

    async function initRound(){
      stopTimer();
      solved = false;
      boardEl.innerHTML = '';
      nextBtn.style.display = 'none';

      const round = rounds[currentRound];
      roundEl.textContent = String(currentRound + 1);

      loadingEl.textContent = 'Loading imagesâ€¦';
      setFeedback(`Round ${currentRound + 1}: <strong>${round.name}</strong><br/>You have ${CHOICE_SECONDS} seconds. Click the odd one out.`);

      // preload so timer doesn't start until images are ready
      const results = await preloadRoundImages(round);
      const failed = results.filter(r => !r.ok).length;

      loadingEl.textContent = failed ? `Some images failed to load (${failed}).` : '';

      // render tiles (images visible immediately)
      for(let i=0;i<4;i++){
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.dataset.index = String(i);
        tile.tabIndex = 0;
        tile.setAttribute('role','button');
        tile.setAttribute('aria-label', `Tile ${i + 1}`);

        const img = document.createElement('img');
        const fileName = round.images[i];
        img.src = imgUrl(fileName);
        img.alt = round.name;
        img.onerror = () => { img.src = makeMissingSvg(`images/${fileName}`); };

        tile.appendChild(img);
        boardEl.appendChild(tile);
      }

      // start timer AFTER images are placed
      startTimer();
    }

    function handleTileClick(tileEl){
      if(!tileEl || solved) return;

      if(tickOn) ensureAudio();

      const idx = Number(tileEl.dataset.index);
      const round = rounds[currentRound];

      const isCorrect = idx === round.odd;
      markSelection(tileEl, isCorrect);

      if(isCorrect){
        solved = true;
        score += 1;
        scoreEl.textContent = String(score);
        stopTimer();
        setFeedback(`<strong>Correct!</strong> ${round.explain}`);
        nextBtn.style.display = 'inline';
      }else{
        setFeedback(`Not quite. Try again. <em>Hint:</em> compare texture, base, and plating.`);
      }
    }

    boardEl.addEventListener('click', (e) => {
      const tile = e.target.closest('.tile');
      handleTileClick(tile);
    });

    boardEl.addEventListener('keydown', (e) => {
      if(e.key !== 'Enter' && e.key !== ' ') return;
      const tile = e.target.closest('.tile');
      if(!tile) return;
      e.preventDefault();
      handleTileClick(tile);
    });

    function nextRound(){
      if(currentRound < rounds.length - 1){
        currentRound += 1;
        initRound();
      }else{
        stopTimer();
        setFeedback(`<strong>Archive Master!</strong><br/>Final score: ${score}/${rounds.length}`);
        nextBtn.style.display = 'none';
      }
    }

    function restart(){
      stopTimer();
      currentRound = 0;
      score = 0;
      scoreEl.textContent = '0';
      initRound();
    }

    nextBtn.addEventListener('click', nextRound);
    restartBtn.addEventListener('click', restart);

    updateTickButton();
    initRound();
  </script>
</body>
</html>
